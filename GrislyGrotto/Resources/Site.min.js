var Credentials=function(){function n(n,t){this.Username=n,this.Password=t}return n}(),Post=function(){function n(n,t,i){this.Title=n,this.Content=t,this.Type=i}return n}(),MainBlogControl=function(){function n(){}return n.getParameterByName=function(n){var t=RegExp("[?&]"+n+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))},n.downloadTemplateAsync=function(n,t){$.ajax({method:"GET",async:!1,url:"/resources/templates/"+n+".template.htm?v=10.4",success:function(n){t($.templates(n))}})},n.downloadTemplate=function(n,t){$.get("/resources/templates/"+n+".template.htm?v=10.4",function(n){t($.templates(n))})},n.postJson=function(n,t,i){$.ajax({type:"POST",url:n,contentType:"application/json; charset=utf-8",data:JSON.stringify(t),dataType:"json",success:function(n){i(n)}})},n.showAuthenticationZone=function(t,i){$(".authenticationZone").remove(),$(t).after(n.authenticationTemplate.render()),$(t).hide(),$(".checkedForValidCredentials").keyup(function(){$(".username").val()!=""&&$(".password").val()!=""?$(".authenticate").removeAttr("disabled"):$(".authenticate").attr("disabled","disabled")}),$(".authenticate").click(function(){n.checkAuthentication(i)})},n.checkAuthentication=function(t){n.userCredentials=new Credentials($(".username").val(),$(".password").val());var i="/Blog.svc/";i+=t?"CheckAuthenticationForPost/"+t:"CheckAuthentication",n.postJson(i,n.userCredentials,function(i){if($(".authenticationZone").remove(),!i){$(".authenticationError").text("Authentication failed, please try again");return}t?$.getJSON("/Blog.svc/Post/"+t+"?r="+Math.random(),function(i){n.renderEditor(t,i)}):n.renderEditor(t,{Title:"",Content:""})})},n.loadLatest=function(){$.getJSON("/Blog.svc/LatestPosts?r="+Math.random(),function(t){n.renderPosts(t)})},n.loadPost=function(t,i){$.getJSON("/Blog.svc/Post/"+t+"?r="+Math.random(),function(r){n.renderPosts(r),$(".posts").append(n.commentsTemplate.render(r)),$(".commentSubmitButton").click(function(){n.submitComment(parseInt($(this).attr("name")))}),$(".checkedForValidComment").keyup(function(){$(".commentAuthor").val()!=""&&$(".commentText").val()!=""?$(".commentSubmitButton").removeAttr("disabled"):$(".commentSubmitButton").attr("disabled","disabled")}),$(".editPostLink").click(function(){return n.showAuthenticationZone(this,t),!1}),i&&document.getElementById("commentsBegin").scrollIntoView(!0)})},n.renderPosts=function(t){$(".posts").html(n.postTemplate.render(t)),$(".postLink").click(function(){return n.loadPost(parseInt($(this).attr("name")),!0),!1})},n.loadArchives=function(t){$.getJSON("/Blog.svc/Archives?r="+Math.random(),function(i){$(".archives").append(t.render(i)),$(".archives").change(function(){var t=$(this).val().split(",");$(".stories").val("/"),$.getJSON("/Blog.svc/Month/"+t[0]+"/"+t[1]+"?r="+Math.random(),function(t){n.renderPosts(t)})})})},n.loadStories=function(t){$.getJSON("/Blog.svc/Stories?r="+Math.random(),function(i){$(".stories").append(t.render(i)),$(".stories").change(function(){$(".archives").val("/"),n.loadPost($(this).val())})})},n.renderEditor=function(t,i){$.getJSON("/Blog.svc/GetEditorState?r="+Math.random(),function(r){r!=null&&(i?(i.Title=r.Title,i.Content=r.Content):i=r),$(".posts").html(n.editorTemplate.render(i)),t&&(i.isEditorMode=!0,$(".posts").append(n.commentsTemplate.render(i))),$(".viewType").change(function(){n.changeViewType()}),$(".addAssetLink").click(function(){return $(".addAssetLink").hide(),$(".addAsset").show(),!1}),$(".hideAddAsset").click(function(){return $(".addAsset").hide(),$(".addAssetLink").show(),!1}),$(".submitPost").click(function(){return n.addOrEditPost(t),!1}),$(".deleteCommentLink").click(function(){if(confirm("Are you sure you want to delete this comment?")){var n=$(this);$.post("/Blog.svc/DeleteComment/"+$(this).attr("href"),function(){$(n).parent().remove()})}return!1}),$(".deletePostLink").click(function(){return confirm("Are you sure you want to delete this post?")&&$.ajax({type:"POST",url:"/Blog.svc/DeletePost",contentType:"application/json; charset=utf-8",data:JSON.stringify({request:{Credentials:n.userCredentials,Id:t}}),dataType:"json",success:function(){document.location.reload(!0)}}),!1}),setTimeout(function(){n.saveEditorState()},5e3)})},n.saveEditorState=function(){if($(".editor").length!=0){$(".editorState").html("Saving...");var t={post:new Post($(".title").text(),$(".content").html(),"Normal")};n.editorViewType=="html"&&(t.post.Content=$(".content").text()),$(".isStory").attr("checked")&&(t.post.Type="Story"),n.postJson("/Blog.svc/SaveEditorState",t,function(){setTimeout(function(){$(".editorState").html("Saved")},500)}),setTimeout(function(){n.saveEditorState()},5e3)}},n.changeViewType=function(){n.editorViewType=="normal"?(n.editorViewType="html",$(".content").text($(".content").html())):(n.editorViewType="normal",$(".content").html($(".content").text()))},n.addOrEditPost=function(t){var i={request:{Credentials:n.userCredentials,Post:new Post($(".title").text(),$(".content").html(),"Normal")}};n.editorViewType=="html"&&(i.request.Post.Content=$(".content").text()),$(".isStory").attr("checked")&&(i.request.Post.Type="Story"),t&&(i.request.Post.Id=t),n.postJson("/Blog.svc/AddOrEditPost",i,function(){document.location.reload(!0)})},n.submitComment=function(t){$(".commentAuthor").attr("disabled","disabled"),$(".commentText").attr("disabled","disabled"),$(".commentSubmitButton").attr("disabled","disabled");var i={comment:{Author:$(".commentAuthor").val(),Text:$(".commentText").val()}};n.postJson("/Blog.svc/AddComment/"+t,i,function(){n.loadPost(t)})},n.Run=function(){n.editorViewType="normal",n.downloadTemplateAsync("post",function(t){n.postTemplate=t;var i=n.getParameterByName("id");i!=null?n.loadPost(parseInt(i)):$.ajax({method:"GET",async:!1,url:"/Blog.svc/LatestPosts?r="+Math.random(),success:function(t){n.renderPosts(t)}})}),n.downloadTemplate("comments",function(t){n.commentsTemplate=t}),n.downloadTemplate("authentication",function(t){n.authenticationTemplate=t,$(".newPostLink").click(function(){return n.showAuthenticationZone(this),!1})}),n.downloadTemplate("editor",function(t){n.editorTemplate=t}),n.downloadTemplate("archive",function(t){n.loadArchives(t)}),n.downloadTemplate("story",function(t){n.loadStories(t)}),n.downloadTemplateAsync("quote",function(n){$.ajax({method:"GET",async:!1,url:"/Blog.svc/Quote?r="+Math.random(),success:function(t){$(".quote").html(n.render(t))}})}),$(".header").click(function(){$(".archives").val("/"),$(".stories").val("/"),$(".newPostLink").show(),n.loadLatest()}),$(".searchButton").click(function(){$.getJSON("/Blog.svc/Search/"+$(".searchTerm").val()+"?r="+Math.random(),function(t){n.renderPosts(t)})})},n}();$().ready(function(){MainBlogControl.Run()})